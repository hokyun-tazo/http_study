# TCP 성능 고려
 - HTTP는 TCP를 기반으로 동작하기 때문에 **HTTP 트랜잭션의 성능은 TCP 성능에 영향을 받는다**
 ---
 
 ## HTTP 트랜잭션 지연
  - 트랜잭션을 처리하는 시간에 비해 TCP커넥션 설정, 전송, 응답 소요시간이 너무 지연된다
  - **대부분의 HTTP지연은 TCP네트워크 지연 때문에 발생한다**
 
 ![image](https://user-images.githubusercontent.com/104821475/188907051-25861268-a9bc-4691-bec3-f21834c3f945.png)

---

 ## TCP 성능 관련 중요요소
  
 #### TCP 커넥션 핸드 셰이크 지연
 - **SYN -> SYN/ACK -> ACK and data로 하는 패킷교환은 HTTP 성능을 크게 저하시킬수 있다**
 - HTTP 트랜잭션이 아주 큰 데이터를 주고받지 않는 평범한 경우에는 핸드셰이크가 눈에 띄는 지연을 발생시킨다
 - TCP의 ACK 패킷은 큰 경우가 많고 크기가 작은 HTTP 트랜잭션은 50% 이상의 시간을 TCP구성하는데 쓴다
 
 ![image](https://user-images.githubusercontent.com/104821475/188907858-bd876eff-c063-4d6e-9113-945ff5c64f8a.png)

 #### 확인응답 지연
 - TCP는 성공적인 데이터 전송을 보장하기 위해 **확인 체계를 가진다**
 - 네트워크를 효율적으로 사용하기 위해 **응답 패킷은 크기가 작기 때문에 같은 방향으로 송출되는 데이터 패킷에 편승시킨다**
 - 편승할 패킷을 찾으려고 하지만 **HTTP동작 방식은 해당 방향으로 송출될 패킷이 많지 않기 때문에** 확인응답 지연 알고리즘 때문에 지연이 발생한다

 #### TCP의 느린시작
 - **TCP 연결 초기에는 연결속도(패킷의 수)를 제한하다가 데이터가 성공될 때 마다 연결 속도제한을 높여 가는걸 TCP 느린시작이라고 한다**
 - 급작스러운 부하와 혼잡을 방지하는데 쓰인다
 - 이 혼잡제어 기능 때문에 **새로운 커넥션은 데이터를 주고받은 커넥션보다 느리게 된다**
 - 데이터를 주고받은 커넥션이 빠르기 때문에 HTTP에는 존재하는 커넥션을 재사용하는 기능이있다

![image](https://user-images.githubusercontent.com/104821475/188909045-2466f1ce-46b5-4be3-99e2-d925fc9488cc.png)

 #### 네이글 알고리즘과 TCP_NODELEY
 - 1byte의 데이터여도 TCP stack으로 전송할수 있도록 TCP 세그먼트(40byte)를 포함하여 전송한다
 - **네이글 알고리즘은 세그먼트가 최대 크기가 되지 않으면 전송을 하지 않는 알고리즘(작은 세그먼트가 많이 전송되는 것을 방지)이다**
 - 작은 HTTP 메시지는 패킷을 채우지 못하기 때문에 **언제 생길지 모르는 데이터를 기다리며 지연된다**
 - 네이글 알고리즘은 확인 응답이 올때까지 데이터 전송을 멈추고 있는 반면 확인 응답지연은 확인 응답을 편승할 패킷을 찾고자 지연시키기 떄문에 두개가 함께 쓰일 경우 형편없이 동작한다


 
